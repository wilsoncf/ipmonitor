<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes - IP Monitor</title>
    <link rel="icon" href="data:,">
    <script>
        // Fun√ß√£o para detectar o caminho base dos est√°ticos
        function getStaticPath() {
            const path = window.location.pathname;
            return path.includes('/ipmonitor/') ? '/ipmonitor/static/' : '/static/';
        }
        
        // Carregar CSS dinamicamente
        function loadCSS(filename) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = getStaticPath() + filename;
            document.head.appendChild(link);
        }
        
        // Carregar CSS
        loadCSS('styles.css');
        loadCSS('config.css');
    </script>
    <script>
        function getBasePath() {
            const path = window.location.pathname;
            return path.includes('/ipmonitor/') ? '/ipmonitor/' : '/';
        }
        function navigateTo(page) {
            const basePath = getBasePath();
            if (page === 'home') {
                window.location.href = basePath;
            } else {
                window.location.href = basePath + page;
            }
        }
    </script>
</head>
<body>

    <nav>
        <!-- Controles principais -->
        <div id="nav-controls">
            <button id="botaoInicio" onclick="navigateTo('home')">
                P√°gina Inicial
            </button>
            <button id="botaoDispositivos" onclick="navigateTo('dispositivos')">
                Dispositivos
            </button>
            <button id="botaoConfiguracoes" class="active" onclick="navigateTo('configuracoes')">
                Configura√ß√µes
            </button>
        </div>

        <!-- Informa√ß√µes de Rede -->
        <div id="network-info">
            <span class="network-info-item">
                <strong>Vers√£o:</strong> <span id="system-version">{{ config.system_info.version }}</span>
            </span>
        </div>
    </nav>

    <!-- Container Principal -->
    <div id="config-container">
        <h1>‚öôÔ∏è Configura√ß√µes do Sistema</h1>
        
        <!-- Mensagem de Status -->
        <div id="status-message" class="hidden"></div>
        
        <!-- Formul√°rio de Configura√ß√µes -->
        <form id="config-form">
            
            <!-- Se√ß√£o: Intervalos de Ping -->
            <section class="config-section">
                <h2>üì° Intervalos de Ping por VLAN</h2>
                <p class="section-description">Configure o intervalo (em segundos) entre verifica√ß√µes de ping para cada VLAN.</p>
                
                <div class="config-grid">
                    {% for vlan in config.vlans.active_vlans %}
                    <div class="config-item">
                        <label for="ping_vlan_{{ vlan }}">{{ config.vlans.vlan_descriptions[vlan|string] }}:</label>
                        <input type="number" 
                               id="ping_vlan_{{ vlan }}" 
                               name="ping_intervals.vlan_{{ vlan }}" 
                               value="{{ config.ping_intervals['vlan_' + vlan|string] }}" 
                               min="5" 
                               max="300" 
                               step="1">
                        <span class="input-unit">segundos</span>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <!-- Se√ß√£o: Configura√ß√µes de Rede -->
            <section class="config-section">
                <h2>üåê Configura√ß√µes de Rede</h2>
                <p class="section-description">Par√¢metros t√©cnicos para verifica√ß√£o de conectividade.</p>
                
                <div class="config-grid">
                    <div class="config-item">
                        <label for="ping_timeout">Timeout do Ping:</label>
                        <input type="number" 
                               id="ping_timeout" 
                               name="network_settings.ping_timeout" 
                               value="{{ config.network_settings.ping_timeout }}" 
                               min="1" 
                               max="10" 
                               step="0.5">
                        <span class="input-unit">segundos</span>
                    </div>
                    
                    <div class="config-item">
                        <label for="max_concurrent_pings">Pings Simult√¢neos:</label>
                        <input type="number" 
                               id="max_concurrent_pings" 
                               name="network_settings.max_concurrent_pings" 
                               value="{{ config.network_settings.max_concurrent_pings }}" 
                               min="1" 
                               max="10" 
                               step="1">
                        <span class="input-unit">threads</span>
                    </div>
                    
                    <div class="config-item">
                        <label for="retry_attempts">Tentativas de Retry:</label>
                        <input type="number" 
                               id="retry_attempts" 
                               name="network_settings.retry_attempts" 
                               value="{{ config.network_settings.retry_attempts }}" 
                               min="0" 
                               max="5" 
                               step="1">
                        <span class="input-unit">tentativas</span>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o: Interface do Usu√°rio -->
            <section class="config-section">
                <h2>üñ•Ô∏è Interface do Usu√°rio</h2>
                <p class="section-description">Personalize a experi√™ncia da interface web.</p>
                
                <div class="config-grid">
                    <div class="config-item checkbox-item">
                        <label for="auto_refresh">
                            <input type="checkbox" 
                                   id="auto_refresh" 
                                   name="ui_settings.auto_refresh" 
                                   {{ 'checked' if config.ui_settings.auto_refresh else '' }}>
                            Atualiza√ß√£o Autom√°tica
                        </label>
                    </div>
                    
                    <div class="config-item">
                        <label for="refresh_rate">Taxa de Atualiza√ß√£o:</label>
                        <input type="number" 
                               id="refresh_rate" 
                               name="ui_settings.refresh_rate" 
                               value="{{ config.ui_settings.refresh_rate }}" 
                               min="1" 
                               max="60" 
                               step="1"
                               {{ 'disabled' if not config.ui_settings.auto_refresh else '' }}>
                        <span class="input-unit">segundos</span>
                    </div>
                    
                    <div class="config-item checkbox-item">
                        <label for="show_offline_devices">
                            <input type="checkbox" 
                                   id="show_offline_devices" 
                                   name="ui_settings.show_offline_devices" 
                                   {{ 'checked' if config.ui_settings.show_offline_devices else '' }}>
                            Mostrar Dispositivos Offline
                        </label>
                    </div>
                    
                    <div class="config-item">
                        <label for="theme">Tema da Interface:</label>
                        <select id="theme" name="ui_settings.theme">
                            <option value="default" {{ 'selected' if config.ui_settings.theme == 'default' else '' }}>Padr√£o</option>
                            <option value="dark" {{ 'selected' if config.ui_settings.theme == 'dark' else '' }}>Escuro</option>
                            <option value="high-contrast" {{ 'selected' if config.ui_settings.theme == 'high-contrast' else '' }}>Alto Contraste</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o: Monitoramento -->
            <section class="config-section">
                <h2>üìä Monitoramento e Logs</h2>
                <p class="section-description">Configura√ß√µes de logging e alertas do sistema.</p>
                
                <div class="config-grid">
                    <div class="config-item checkbox-item">
                        <label for="enable_logging">
                            <input type="checkbox" 
                                   id="enable_logging" 
                                   name="monitoring.enable_logging" 
                                   {{ 'checked' if config.monitoring.enable_logging else '' }}>
                            Habilitar Logging
                        </label>
                    </div>
                    
                    <div class="config-item">
                        <label for="log_level">N√≠vel de Log:</label>
                        <select id="log_level" name="monitoring.log_level">
                            <option value="DEBUG" {{ 'selected' if config.monitoring.log_level == 'DEBUG' else '' }}>Debug</option>
                            <option value="INFO" {{ 'selected' if config.monitoring.log_level == 'INFO' else '' }}>Info</option>
                            <option value="WARNING" {{ 'selected' if config.monitoring.log_level == 'WARNING' else '' }}>Warning</option>
                            <option value="ERROR" {{ 'selected' if config.monitoring.log_level == 'ERROR' else '' }}>Error</option>
                        </select>
                    </div>
                    
                    <div class="config-item">
                        <label for="max_log_entries">M√°ximo de Logs:</label>
                        <input type="number" 
                               id="max_log_entries" 
                               name="monitoring.max_log_entries" 
                               value="{{ config.monitoring.max_log_entries }}" 
                               min="100" 
                               max="10000" 
                               step="100">
                        <span class="input-unit">entradas</span>
                    </div>
                    
                    <div class="config-item checkbox-item">
                        <label for="alert_on_device_down">
                            <input type="checkbox" 
                                   id="alert_on_device_down" 
                                   name="monitoring.alert_on_device_down" 
                                   {{ 'checked' if config.monitoring.alert_on_device_down else '' }}>
                            Alertar Dispositivo Offline
                        </label>
                    </div>
                </div>
            </section>

            <!-- Bot√µes de A√ß√£o -->
            <div class="action-buttons">
                <button type="submit" id="save-btn" class="btn-primary">üíæ Salvar Configura√ß√µes</button>
                <button type="button" id="reset-btn" class="btn-secondary">üîÑ Restaurar Padr√µes</button>
                <button type="button" id="test-btn" class="btn-info">üß™ Testar Configura√ß√µes</button>
            </div>
        </form>
    </div>

    <!-- Script para navega√ß√£o e recursos -->
    <script>
        // Fun√ß√£o para detectar ambiente e gerar URLs corretas
        function getBaseUrl() {
            const hostname = window.location.hostname;
            const isProduction = hostname.includes('automacao.tce.go.gov.br');
            return isProduction ? '/ipmonitor' : '';
        }
        
        // Corrigir caminhos CSS se necess√°rio
        document.addEventListener('DOMContentLoaded', function() {
            const baseUrl = getBaseUrl();
            
            // Verificar se CSS est√° carregado, se n√£o, recarregar com caminho correto
            const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
            stylesheets.forEach(link => {
                if (link.href.includes('static/') && !link.href.includes(baseUrl)) {
                    const filename = link.href.split('static/')[1];
                    link.href = baseUrl + '/static/' + filename;
                }
            });
            

        });
    </script>

    <!-- Script -->
    <script>
        // Carregar JavaScript dinamicamente
        const scriptSrc = getStaticPath() + 'config.js';
        const script = document.createElement('script');
        script.src = scriptSrc;
        document.head.appendChild(script);
    </script>

    <footer>
        <div class="footer-content">
            <p>@Sistema WEB desenvolvido por Wilson do Serv. Infraestrutura Predial.</p>
        </div>
    </footer>

</body>
</html>